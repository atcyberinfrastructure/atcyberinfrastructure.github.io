/*! @name videojs-schema @version 0.8.0 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js"),require("global/document"),require("global/window")):"function"==typeof define&&define.amd?define(["video.js","global/document","global/window"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsSchema=t(e.videojs,e.document,e.window)}(this,(function(e,t,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=n(e),d=n(t),s=n(i),o=function(e){var t=[];return e.src&&t.push(e.src),e.sources&&(t=t.concat(e.sources.map((function(e){return e.src})))),t.find((function(e){return e.startsWith(s.default.location.protocol)||e.startsWith("https:")||e.startsWith("data:")}))||null},r={schemaId:"https://players.brightcove.net/{accountId}/{playerId}_{embedId}/index.html?videoId={id}",keywords:!1,excludeTags:[],baseObject:{},includeEmbedUrl:!0,preferLongDescription:!1,transcript:!1,transcriptMatchAny:!1,skipRules:{tags:[],customFields:{}}},c=a.default.obj?a.default.obj.merge:a.default.mergeOptions,l=function(e){var t=this;this.schemaEl_=d.default.createElement("script"),this.schemaEl_.type="application/ld+json",d.default.head.appendChild(this.schemaEl_),e=c(r,e),this.on(["loadstart","error"],(function(i){if(t.bcinfo&&t.catalog&&t.mediainfo&&t.mediainfo.id){var n=t.catalog.getMetadata?t.catalog.getMetadata({lang:t.language()}):t.mediainfo;if(e.skipRules.tags&&e.skipRules.tags.some((function(e){return n.tags.includes(e)}))||e.skipRules.customFields&&Object.keys(e.skipRules.customFields).some((function(t){return n.customFields[t]===e.skipRules.customFields[t]})))return a.default.log.debug("Skipping generating schema metadata based on skip rule."),void(t.schemaEl_.textContent="");var s=c(e.baseObject,{"@context":"http://schema.org/","@type":"VideoObject",name:n.name,thumbnailUrl:n.poster,uploadDate:n.publishedAt,"@id":e.schemaId.replace("{id}",n.id).replace("{referenceId}",n.referenceId).replace("{playerId}",t.bcinfo.playerId).replace("{embedId}",t.bcinfo.embedId).replace("{accountId}",t.bcinfo.accountId)});e.preferLongDescription?s.description=n.longDescription||n.description||n.name:s.description=n.description||n.name;var r=function(e){if(!((e=Math.round(e))<=0)&&isFinite(e)){var t=parseInt(e/3600,10),i=parseInt((e-3600*t)/60,10),n="PT";return t>0&&(n+=t+"H"),i>0&&(n+=i+"M"),n+(e-3600*t-60*i+"S")}}(n.duration);if(r&&(s.duration=r),e.includeEmbedUrl)if(t.socialSettings){var l=d.default.createElement("div");l.innerHTML=t.socialOverlay.getEmbedCode(),s.embedUrl=l.querySelector("iframe").src}else s.embedUrl="https://players.brightcove.net/"+t.bcinfo.accountId+"/"+t.bcinfo.playerId+"_"+t.bcinfo.embedId+"/index.html?videoId="+n.id;if(e.keywords){var u=[];n.tags.forEach((function(t){-1===e.excludeTags.indexOf(t)&&u.push(t)})),u.length>0&&(s.keywords=u.join(","))}if(e.transcript){var f=n.textTracks.find((function(e){return("captions"===e.kind||"subtitles"===e.kind)&&o(e)&&e.srclang.split("-")[0]===t.language().split("-")[0]}));f||e.transcriptMatchAny||(f=n.textTracks.find((function(e){return("captions"===e.kind||"subtitles"===e.kind)&&o(e)}))),f?a.default.xhr(o(f),(function(e,i){if(e||i.statusCode>=400)a.default.log.debug(e,i.statusCode);else{for(var n,d=/(\d\d:)?\d\d:\d\d\.\d\d\d[ \t]+-->[ \t]+(\d\d:)?\d\d:\d\d\.\d\d\d.*\n((.+\n)+)/gm,o=[];null!==(n=d.exec(i.body));)o.push(n[3]);s.transcript=o.join(""),t.schemaEl_.textContent=JSON.stringify(s)}})):a.default.log.debug("No matching track")}t.schemaEl_.textContent=JSON.stringify(s)}else a.default.log.warn("Unable to add schema without catalog info.")})),this.on("dispose",(function(e){t.schemaEl_.parentNode.removeChild(t.schemaEl_)}))};return a.default.registerPlugin("schema",l),l.VERSION="0.8.0",l}));
